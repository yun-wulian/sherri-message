"use strict";const n=require("electron");function I(){return n.ipcRenderer.sendSync("LiteLoader.sherri_message.getWebContentId")||2}const f=I();console.log("[sherri-message] Preload: webContentId =",f);const g=[];function s(...e){const c=new Date().toLocaleTimeString("zh-CN",{hour12:!1}),i=e.map(r=>{if(typeof r=="object")try{return JSON.stringify(r,null,0)}catch{return String(r)}return String(r)}).join(" "),t=`[${c}] [preload] ${i}`;g.push(t),console.log("[sherri-message]",...e)}function p(e,c,i){const t=crypto.randomUUID(),r=I();s("nativeCall 发送:",{callbackId:t,event:e,payload:c?.cmdName||c,webContentId:r});let a;return i?a=new Promise(l=>{function d(...R){const o=R[1],m=R[2];s("收到 IPC 响应:",{headerCallbackId:o?.callbackId,expectedCallbackId:t,match:o?.callbackId===t,cmdName:o?.cmdName}),typeof i=="boolean"?o?.callbackId===t&&(s("回调匹配成功, 返回数据"),n.ipcRenderer.off(`RM_IPCFROM_MAIN${r}`,d),l(m)):Array.isArray(i)?i.includes(o?.cmdName||"")&&(s("cmdName 匹配成功:",o?.cmdName),n.ipcRenderer.off(`RM_IPCFROM_MAIN${r}`,d),l(m)):o?.cmdName===i&&(s("cmdName 匹配成功:",o?.cmdName),n.ipcRenderer.off(`RM_IPCFROM_MAIN${r}`,d),l(m))}s("开始监听 IPC 通道:",`RM_IPCFROM_MAIN${r}`),n.ipcRenderer.on(`RM_IPCFROM_MAIN${r}`,d)}):a=Promise.resolve(null),s("发送到 IPC 通道:",`RM_IPCFROM_RENDERER${r}`),n.ipcRenderer.send(`RM_IPCFROM_RENDERER${r}`,{peerId:r,callbackId:t,...e},c),a}const _={getConfig:()=>n.ipcRenderer.invoke("LiteLoader.sherri_message.getConfig"),setConfig:e=>n.ipcRenderer.invoke("LiteLoader.sherri_message.setConfig",e),saveTempImage:e=>n.ipcRenderer.invoke("LiteLoader.sherri_message.saveTempImage",e),deleteTempFile:e=>n.ipcRenderer.invoke("LiteLoader.sherri_message.deleteTempFile",e),getFileInfo:e=>n.ipcRenderer.invoke("LiteLoader.sherri_message.getFileInfo",e),checkFileExists:e=>n.ipcRenderer.invoke("LiteLoader.sherri_message.checkFileExists",e),getWebContentId:()=>I(),nativeCall:p,log:(...e)=>n.ipcRenderer.send("LiteLoader.sherri_message.log",...e),getPreloadLogs:()=>{const e=[...g];return g.length=0,e}};n.contextBridge.exposeInMainWorld("sherri_message",_);
