"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("electron"),m=require("fs"),h=require("path"),p=require("crypto");function u(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:()=>e[t]})}}return r.default=e,Object.freeze(r)}const n=u(m),l=u(h),f=u(p),o=LiteLoader.plugins["sherri-message"].path.data,a=l.join(o,"config.json"),c=l.join(o,"temp");function d(){n.existsSync(o)||n.mkdirSync(o,{recursive:!0}),n.existsSync(c)||n.mkdirSync(c,{recursive:!0})}function y(){d();try{if(n.existsSync(a)){const e=n.readFileSync(a,"utf-8");return JSON.parse(e)}}catch(e){console.error("[sherri-message] 读取配置失败:",e)}return{}}function _(e){d();try{return n.writeFileSync(a,JSON.stringify(e,null,2),"utf-8"),!0}catch(r){return console.error("[sherri-message] 保存配置失败:",r),!1}}function S(e){d();try{const r=e.replace(/^data:image\/\w+;base64,/,""),t=Buffer.from(r,"base64"),i=`sherri_${Date.now()}_${f.randomBytes(4).toString("hex")}.png`,g=l.join(c,i);return n.writeFileSync(g,t),g}catch(r){return console.error("[sherri-message] 保存临时图片失败:",r),null}}function L(e){try{if(e&&n.existsSync(e))return n.unlinkSync(e),!0}catch(r){console.error("[sherri-message] 删除临时文件失败:",r)}return!1}function b(e){try{if(!n.existsSync(e))return console.error("[sherri-message] 文件不存在:",e),null;const r=n.readFileSync(e),t=f.createHash("md5").update(r).digest("hex").toLowerCase(),i=r.length;return console.log("[sherri-message] 文件信息:",{path:e,md5:t,size:i}),{md5:t,size:i}}catch(r){return console.error("[sherri-message] 获取文件信息失败:",r),null}}function w(e){try{return n.existsSync(e)}catch{return!1}}s.ipcMain.handle("LiteLoader.sherri_message.getConfig",()=>y());s.ipcMain.handle("LiteLoader.sherri_message.setConfig",(e,r)=>_(r));s.ipcMain.handle("LiteLoader.sherri_message.saveTempImage",(e,r)=>S(r));s.ipcMain.handle("LiteLoader.sherri_message.deleteTempFile",(e,r)=>L(r));s.ipcMain.handle("LiteLoader.sherri_message.getFileInfo",(e,r)=>b(r));s.ipcMain.handle("LiteLoader.sherri_message.checkFileExists",(e,r)=>w(r));s.ipcMain.on("LiteLoader.sherri_message.log",(e,...r)=>{console.log("[sherri-message]",...r)});s.ipcMain.on("LiteLoader.sherri_message.getWebContentId",e=>{console.log("[sherri-message] getWebContentId called, sender.id:",e.sender.id),e.returnValue=e.sender.id});const C=e=>{console.log("[sherri-message] onBrowserWindowCreated called, webContentsId:",e.webContents.id)};exports.onBrowserWindowCreated=C;
